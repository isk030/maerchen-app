<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: client/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: client/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Main frontend logic
 * @module Client/index
 */

/* eslint-disable no-unused-vars */
/* eslint-disable no-undef */

/**
 * Setting base url
 */
const serverUrl = 'https://maerchen-server.herokuapp.com';

/**
 * Jquery logic after loading document
 */
$(document).ready(function () {

	/**
	 * Declaring variable for further use
	 */
	const $talesList = $('#talesList');
	const $favList = $('#favList');
	let token = null;
	let userId = null;
	let favarr = [];
   
	// preventing forms to switch to default
	$('#formular').submit(function(e) {
		e.preventDefault();
	});

	$('#formular2').submit(function(e) {
		e.preventDefault();
	});

	/**
	 * Ajax GET request for loading in all Tales from DB
	 */
	$.ajax({
		type:'GET',
		url: serverUrl+'/tale',
		success: function(data) {
			taleList = data;
			// console.log(data)
			$.each(data.tales, function(i, el) {
				$talesList.append('&lt;li id="'+el._id+'" class="list-group-item list-group-item-action" >'+el.title+'&lt;/li>');
			});
		}
	});
	
	/**
	 * Behavior for signup button
	 */
	$(document).on('click', '#signup', function(){
		var email = $('#emailSignup').val();
		var password = $('#passwordSignup').val();
		/**
		 * POST request with credential including validation
		 */
		$.ajax({
			type: 'POST',
			url: serverUrl+'/user/signup',
			data: {
				email: email.toString(),
				password: password.toString()
			},
			statusCode: {
				500: function(data) {
					alert('Etwas ging schief. Versuche es nochmal');
				},
				409: function(data) {
					alert(JSON.stringify(data.responseJSON.message));
				}
			}
		}).done(function(data){
			alert(JSON.stringify(data.message));
		});
	});

	/**
	 * Behavior for login button
	 */
	$(document).on('click', '#login', function(){
		var email = $('#emailLogin').val();
		var password = $('#passwordLogin').val();
		$favList.empty();
		/**
		 * POST request with credentials to get and save webtoken
		 */
		$.ajax({
			type: 'POST',
			url: serverUrl+'/user/login',
			data: {
				email: email.toString(),
				password: password.toString()
			},
			statusCode: {
				500: function(data) {
					alert('Etwas ging schief. Versuche es nochmal');
				},
				401: function(data) {
					alert(JSON.stringify(data.responseJSON.message));
				}
			}
		}).done(function(data){
			alert(JSON.stringify(data.message));
			token = data.token;
			userId = data._id;
        
			$.each(data.favs, function(i, el) {
				const tale = taleList.tales.find(t => t._id == el);
				favarr.push(tale);
				console.log(tale);
				$favList.append('&lt;li id="'+el+'" class="list-group-item list-group-item-action" >'+tale.title+'&lt;/li>');
			});
		});

	});

	/**
	 * Behavior vor add favourites button
	 */
	$(document).on('click', '#addFav', async function() {
		let taleId = await $('#tales > div').attr('id');

		/**
		 * Storing current tale Ids in array as payload for further Patch request
		 */
		await favarr.push(taleId);
		$favList.append('&lt;li id="'+taleList.tales.find(el => el._id == taleId)._id+'" class="list-group-item list-group-item-action" >'+taleList.tales.find(el => el._id == taleId).title+'&lt;/li>');
		console.log(favarr);

		/**
		 * PATCH request to update favs in DB including authorization with JWT
		 */
		$.ajax({
			type: 'PATCH',
			url: serverUrl+'/user/'+userId,
			beforeSend: function (json) {
				/* Authorization header */
				json.setRequestHeader('Authorization', 'Bearer ' + token);
			},
			contentType: 'application/json',
			dataTyoe: 'json',
			data: JSON.stringify({favs: favarr}),
			statusCode: {
				500: function(data) {
					alert('Etwas ging schief. Versuche es nochmal');
				},
				409: function(data) {
					alert(JSON.stringify(data.responseJSON.message));
				}
			}
		}).done(function(data){
			alert(JSON.stringify(data.message));
		});
	});
	
	/**
	 * Behavior for remove favourites button
	 */
	$(document).on('click', '#removeFav', async function() {
		let taleId = await $('#tales > div').attr('id');
		let index = favarr.indexOf(taleId);
		favarr.splice(index);
		$('#favList > #'+taleId+'').remove();
		console.log(favarr);

		/**
		 * PATCH request updating current favourites
		 */
		$.ajax({
			type: 'PATCH',
			url: serverUrl+'/user/'+userId,
			beforeSend: function (json) {
				/* Authorization header */
				json.setRequestHeader('Authorization', 'Bearer ' + token);
			},
			contentType: 'application/json',
			dataTyoe: 'json',
			data: JSON.stringify({favs: favarr}),
			statusCode: {
				500: function(data) {
					alert('Etwas ging schief. Versuche es nochmal');
				},
				409: function(data) {
					alert(JSON.stringify(data.responseJSON.message));
				}
			}
		}).done(function(data){
			alert(JSON.stringify(data.message));
		});
	});

	/**
	 * function to show Tale content after selecting in Tale List
	 */
	$(document).on('click','.list-group-item', function() {
		var id = $(this).attr('id').toString();
		$.each(taleList.tales, function(i, v) {
			if (v._id == id) {
				$('#tales > div').remove();
				$('#tales > h1').remove();
				$('#tales > h3').remove();
				$('#tales').append('&lt;div id="'+id+'">&lt;h1>'+v.title+'&lt;/h1>&lt;h3>'+v.author+'&lt;/h3>&lt;div>'+v.content+'&lt;/div>&lt;/div>'); // get that prettier
			}
		});
   
	});

});

/**
 * Filter/Search function for Tale List
 * @param {String} input 
 */
function filter(input) {
	var value = $(input).val();
	$('#talesList > li').each(function() {
		if ($(this).text().toLowerCase().search(value.toLowerCase()) > -1) {
			$(this).show();
		}
		else {
			$(this).hide();
		}
	});
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-API_Controller_tales.html">API/Controller/tales</a></li><li><a href="module-API_Controller_user.html">API/Controller/user</a></li><li><a href="module-API_routes_tale.html">API/routes/tale</a></li><li><a href="module-API_routes_user.html">API/routes/user</a></li><li><a href="module-Client_index.html">Client/index</a></li><li><a href="module-Models_tale.html">Models/tale</a></li><li><a href="module-Models_user.html">Models/user</a></li><li><a href="module-Service_checkAuth.html">Service/checkAuth</a></li><li><a href="module-Service_crawler.html">Service/crawler</a></li><li><a href="module-Startup_app.html">Startup/app</a></li><li><a href="module-Startup_server.html">Startup/server</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Wed Jun 24 2020 13:35:20 GMT+0200 (Mitteleurop√§ische Sommerzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
